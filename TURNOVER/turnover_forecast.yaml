schemaVersion: 3
meta:
  sourceVersionId: bf22ed02-53c4-4282-96c5-337be85284b5 # DO NOT CHANGE - Hex uses this to match up project versions when reimporting the file
  description: null
  projectId: 6de9a3fd-0345-431a-a01a-73a53fef7597 # DO NOT CHANGE - Unique ID of the project from which this file was generated
  title: turnover_forecast
  timezone: null
  appTheme: SYS_PREF
  codeLanguage: PYTHON
  status: null
  categories: []
  castDecimalsDefault: true
  logicQueryCacheTimeout: null
  publishedQueryCacheTimeout: null
  hexType: PROJECT
  allowExecutionReordering: true
  prerunApp: false
  cachePublishedAppState: true
  refreshStalePublishedApp: false
  autoRerunApp: true
projectAssets:
  dataConnections: []
  envVars: []
  secrets: []
sharedAssets:
  secrets:
    - secretName: SF_ACCOUNT
    - secretName: SF_DATABASE
    - secretName: SF_PASSWORD
    - secretName: SF_ROLE
    - secretName: SF_SCHEMA
    - secretName: SF_USER
    - secretName: SF_WAREHOUSE
  vcsPackages: []
  dataConnections:
    - dataConnectionId: 4391debb-0cd6-494c-bfa2-167e8ad6c4a0 # SNOWFLAKE_TRIAL (snowflake)
    - dataConnectionId: cc4f7aef-f3dc-4259-b8a2-bd93d16d4279 # [Demo] Hex Public Data (snowflake)
  externalFileIntegrations: []
cells:
  - cellType: SQL
    cellId: e7c900f6-2c23-4a7e-b5cd-85b968e49de6 # DO NOT CHANGE - Hex uses this to match up cells when reimporting the file, and detect any changes to existing cells
    cellLabel: null
    config:
      source: select * from turnover;
      dataFrameCell: false
      dataConnectionId: 4391debb-0cd6-494c-bfa2-167e8ad6c4a0
      resultVariableName: dataframe
      useRichDisplay: true
      sqlCellOutputType: PANDAS
      useQueryMode: false
      castDecimals: true
      useNativeDates: true
      outputFilteredResult: true
      allowDuplicateColumns: false
      tableDisplayConfig:
        pageSize: 50
        height: null
        hideIcons: false
        hideIndex: false
        defaultSortColumn: null
        defaultSortIndexColumn: null
        defaultSortDirection: ASC
        conditionalFormatting: null
        calcs: null
        filters: null
        columnProperties:
          - originalName: NET_TURNOVER
            renameTo: null
            size: 144
            wrapText: null
            displayFormat: null
          - originalName: TIME
            renameTo: null
            size: 120
            wrapText: null
            displayFormat: null
          - originalName: row-index-0
            renameTo: null
            size: 46
            wrapText: null
            displayFormat: null
        columnOrdering: null
        customColumnOrdering: null
        pinnedColumns: null
        hiddenColumns: null
        pinIndexColumns: false
        showAggregations: false
        columnAggregations: null
  - cellType: CODE
    cellId: af286fb6-ba50-4a5f-9d5a-a9e2bbd89faa # DO NOT CHANGE - Hex uses this to match up cells when reimporting the file, and detect any changes to existing cells
    cellLabel: null
    config:
      source: |
        import snowflake.connector
        import pandas as pd
        from snowflake.connector import DictCursor
        from snowflake.snowpark.session import Session
        from snowflake.snowpark import DataFrame
        from snowflake.snowpark.functions import col
        from sklearn.ensemble import IsolationForest

        conn_params = {
            "user": "Manthankumar",
            "password": "Ranamanthan@123",
            "account": "wyb94529",
            "warehouse": "COMPUTE_WH",
            "role": "ACCOUNTADMIN",
            "database": "SNOWLENS",
            "schema": "DEMO",
        }

        conn = snowflake.connector.connect(
            user=conn_params['user'],
            password=conn_params['password'],
            account=conn_params['account'],
            warehouse=conn_params['warehouse'],
            role=conn_params['role'],
            database=conn_params['database'],
            schema=conn_params['schema']
        )
        cur = conn.cursor()
        query = "SELECT * FROM turnover"
        cur.execute(query)

        df = cur.fetch_pandas_all()

        model = IsolationForest(contamination=0.1)  
        df['label'] = model.fit_predict(df[['NET_TURNOVER']])

        df['label'] = df['label'].apply(lambda x: 1 if x == -1 else 0)

        cur.close()
        conn.close()

        print(df)
  - cellType: CODE
    cellId: 0e017df7-f8b6-428f-a08d-620df8f66ec6 # DO NOT CHANGE - Hex uses this to match up cells when reimporting the file, and detect any changes to existing cells
    cellLabel: null
    config:
      source: |-
        import snowflake.connector
        import pandas as pd
        from snowflake.connector import DictCursor
        from snowflake.snowpark.session import Session
        from snowflake.snowpark import DataFrame
        from snowflake.snowpark.functions import col
        from sklearn.ensemble import IsolationForest

        conn_params = {
            "user": "Manthankumar",
            "password": "Ranamanthan@123",
            "account": "wyb94529",
            "warehouse": "COMPUTE_WH",
            "role": "ACCOUNTADMIN",
            "database": "SNOWLENS",
            "schema": "DEMO",
        }

        conn = snowflake.connector.connect(
            user=conn_params['user'],
            password=conn_params['password'],
            account=conn_params['account'],
            warehouse=conn_params['warehouse'],
            role=conn_params['role'],
            database=conn_params['database'],
            schema=conn_params['schema']
        )
        cur = conn.cursor()
        query = "SELECT * FROM turnover"
        cur.execute(query)

        df = cur.fetch_pandas_all()

        model = IsolationForest(contamination=0.1)  
        df['label'] = model.fit_predict(df[['NET_TURNOVER']])

        df['label'] = df['label'].apply(lambda x: 1 if x == -1 else 0)

        cur.close()
        conn.close()

        print(df)
appLayout:
  visibleMetadataFields:
    - NAME
    - DESCRIPTION
    - AUTHOR
    - LAST_EDITED
    - LAST_RUN
    - CATEGORIES
    - STATUS
    - TABLE_OF_CONTENTS
  fullWidth: false
  tabs:
    - name: Tab 1
      rows:
        - columns:
            - start: 0
              end: 120
              elements:
                - showSource: false
                  hideOutput: false
                  type: CELL
                  cellId: 0e017df7-f8b6-428f-a08d-620df8f66ec6
                  sharedFilterId: null
                  height: null
                  showLabel: true
sharedFilters: []
